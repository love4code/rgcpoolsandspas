<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title><%= service ? 'Edit' : 'New' %> Service - Admin</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
  <style>
    .icon-picker { max-height: 400px; overflow-y: auto; }
    .icon-item { cursor: pointer; padding: 10px; border: 2px solid transparent; }
    .icon-item:hover { background: #f0f0f0; }
    .icon-item.selected { border-color: #0d6efd; background: #e7f1ff; }
  </style>
</head>
<body>
  <div class="container-fluid">
    <div class="row">
      <nav class="col-md-3 col-lg-2 d-md-block bg-dark sidebar vh-100 position-fixed">
        <div class="position-sticky pt-3">
          <h5 class="text-light px-3 mb-3">Admin Panel</h5>
          <%- include('../../partials/admin-sidebar', { inquiryCount: 0 }) %>
        </div>
      </nav>
      
      <main class="col-md-9 ms-sm-auto col-lg-10 px-md-4" style="margin-left: 16.666667% !important;">
        <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
          <h1 class="h2"><%= service ? 'Edit' : 'New' %> Service</h1>
          <a href="/admin/services" class="btn btn-secondary">Back</a>
        </div>

        <form action="<%= service ? `/admin/services/${service._id}` : '/admin/services' %>" method="POST">
          <div class="row">
            <div class="col-md-8">
              <div class="card mb-3">
                <div class="card-body">
                  <div class="mb-3">
                    <label for="name" class="form-label">Service Name *</label>
                    <input type="text" class="form-control" id="name" name="name" value="<%= service ? service.name : '' %>" required>
                  </div>
                  <div class="mb-3">
                    <label for="description" class="form-label">Description *</label>
                    <textarea class="form-control" id="description" name="description" rows="5" required><%= service ? service.description : '' %></textarea>
                  </div>
                  <div class="mb-3">
                    <label for="displayOrder" class="form-label">Display Order</label>
                    <input type="number" class="form-control" id="displayOrder" name="displayOrder" value="<%= service ? service.displayOrder : 0 %>">
                  </div>
                  <div class="form-check mb-3">
                    <input class="form-check-input" type="checkbox" id="featured" name="featured" <%= service && service.featured ? 'checked' : '' %>>
                    <label class="form-check-label" for="featured">Featured on Home Page</label>
                  </div>
                  <% if (service) { %>
                    <div class="form-check">
                      <input class="form-check-input" type="checkbox" id="active" name="active" <%= service.active ? 'checked' : '' %>>
                      <label class="form-check-label" for="active">Active</label>
                    </div>
                  <% } %>
                </div>
              </div>
            </div>
            <div class="col-md-4">
              <div class="card mb-3">
                <div class="card-body">
                  <h5 class="card-title">Select Icon</h5>
                  <input type="text" class="form-control mb-3" id="iconInput" name="icon" value="<%= service ? service.icon : '' %>" placeholder="bi-icon-name" required>
                  <button type="button" class="btn btn-primary w-100" data-bs-toggle="modal" data-bs-target="#iconModal">Browse Icons</button>
                  <div class="mt-3 text-center">
                    <i id="iconPreview" class="<%= service ? service.icon : 'bi bi-circle' %> display-1"></i>
                  </div>
                </div>
              </div>
              <button type="submit" class="btn btn-success w-100">Save Service</button>
            </div>
          </div>
        </form>
      </main>
    </div>
  </div>

  <!-- Icon Picker Modal -->
  <div class="modal fade" id="iconModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Select Bootstrap Icon</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body icon-picker">
          <input type="text" class="form-control mb-3" id="iconSearch" placeholder="Search icons...">
          <div class="row g-2" id="iconGrid">
            <!-- Icons will be loaded here -->
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Common Bootstrap Icons
    const icons = [
      'bi-house', 'bi-building', 'bi-tools', 'bi-wrench', 'bi-hammer', 'bi-gear',
      'bi-water', 'bi-droplet', 'bi-sun', 'bi-umbrella', 'bi-tree', 'bi-flower1',
      'bi-star', 'bi-heart', 'bi-check-circle', 'bi-info-circle', 'bi-question-circle',
      'bi-telephone', 'bi-envelope', 'bi-calendar', 'bi-clock', 'bi-person', 'bi-people',
      'bi-cart', 'bi-bag', 'bi-cash', 'bi-credit-card', 'bi-receipt', 'bi-gift',
      'bi-award', 'bi-trophy', 'bi-patch-check', 'bi-shield-check', 'bi-shield-lock',
      'bi-lightning', 'bi-fire', 'bi-cloud', 'bi-cloud-rain', 'bi-snow', 'bi-wind'
    ];

    document.getElementById('iconSearch').addEventListener('input', filterIcons);
    
    function loadIcons() {
      const grid = document.getElementById('iconGrid');
      icons.forEach(icon => {
        const col = document.createElement('div');
        col.className = 'col-md-2 col-3';
        col.innerHTML = `
          <div class="icon-item text-center p-3" onclick="selectIcon('${icon}')">
            <i class="${icon} fs-3"></i>
            <div class="small mt-1">${icon.replace('bi-', '')}</div>
          </div>
        `;
        grid.appendChild(col);
      });
    }

    function filterIcons() {
      const search = document.getElementById('iconSearch').value.toLowerCase();
      document.querySelectorAll('.icon-item').forEach(item => {
        const text = item.textContent.toLowerCase();
        item.parentElement.style.display = text.includes(search) ? 'block' : 'none';
      });
    }

    function selectIcon(icon) {
      document.getElementById('iconInput').value = icon;
      document.getElementById('iconPreview').className = icon + ' display-1';
      bootstrap.Modal.getInstance(document.getElementById('iconModal')).hide();
    }

    document.getElementById('iconInput').addEventListener('input', function() {
      const icon = this.value;
      if (icon) {
        document.getElementById('iconPreview').className = icon + ' display-1';
      }
    });

    loadIcons();
  </script>
</body>
</html>

